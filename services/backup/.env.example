# ========================================
# PostgreSQL Backup Service Configuration
# ========================================
# Copy this file to .env and configure your values

# --- REQUIRED: Database Configuration ---

# Option 1: DATABASE_URL (Preferred - Railway native format)
# Format: postgresql://username:password@hostname:port/database
DATABASE_URL=postgresql://postgres:password@localhost:5432/mydb

# Option 2: Individual PostgreSQL Variables (Alternative)
# Use these if DATABASE_URL is not available
# PGHOST=localhost
# PGPORT=5432
# PGUSER=postgres
# PGPASSWORD=password
# PGDATABASE=mydb

# --- REQUIRED: S3 Storage Configuration ---

# S3-compatible storage endpoint (without bucket name)
# Examples:
#   AWS S3: https://s3.amazonaws.com
#   Backblaze B2: https://s3.us-west-002.backblazeb2.com
#   DigitalOcean Spaces: https://nyc3.digitaloceanspaces.com
#   Cloudflare R2: https://<account-id>.r2.cloudflarestorage.com
#   MinIO: http://localhost:9000
S3_ENDPOINT=https://s3.amazonaws.com

# S3 bucket name for storing backups
S3_BUCKET=my-postgres-backups

# S3 access credentials
S3_ACCESS_KEY_ID=your-access-key-id
S3_SECRET_ACCESS_KEY=your-secret-access-key

# --- OPTIONAL: Backup Configuration ---

# Backup interval in seconds (default: 3600 = 1 hour)
# Minimum recommended: 60 seconds
# Examples: 3600 (1h), 21600 (6h), 86400 (24h)
BACKUP_INTERVAL=3600

# Number of days to retain backups (default: 7)
# Backups older than this will be automatically deleted
# Minimum: 1 day
BACKUP_RETENTION_DAYS=7

# AWS region or region identifier (default: us-east-1)
# Required for some S3 providers
S3_REGION=us-east-1

# S3 key prefix for organizing backups (default: postgres-backups)
# All backups will be stored under s3://bucket/prefix/backup_*.sql.gz
BACKUP_PREFIX=postgres-backups

# Gzip compression level 1-9 (default: 6)
# 1 = fastest/larger, 9 = slowest/smaller
# Recommended: 6 for balanced performance
COMPRESSION_LEVEL=6

# --- OPTIONAL: Encryption ---

# Enable backup encryption (default: false)
# Set to 'true' to enable AES-256-CBC encryption
BACKUP_ENCRYPTION=false

# Encryption key (required if BACKUP_ENCRYPTION=true)
# Use a strong, random key (32+ characters recommended)
# IMPORTANT: Store this securely! Lost key = lost backups
# BACKUP_ENCRYPTION_KEY=your-secure-encryption-key-min-32-chars

# --- OPTIONAL: Webhook Notifications ---

# Webhook URL for notifications (optional)
# Sends POST requests with JSON payload on backup events
# Supports Slack, Discord, custom endpoints
# WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL

# Send webhook on successful backups (default: false)
# WEBHOOK_ON_SUCCESS=false

# Send webhook on failed backups (default: true)
# WEBHOOK_ON_FAILURE=true

# --- OPTIONAL: Retry Configuration ---

# Number of retry attempts for S3 upload (default: 3)
# Uses exponential backoff between retries
RETRY_ATTEMPTS=3

# Initial retry delay in seconds (default: 5)
# Delay doubles after each retry (exponential backoff)
RETRY_DELAY=5

# --- OPTIONAL: Debugging ---

# Enable debug logging (default: false)
# Shows detailed logs for troubleshooting
# DEBUG=false

# ========================================
# Example Configurations
# ========================================

# --- Example 1: AWS S3 ---
# DATABASE_URL=postgresql://user:pass@host:5432/db
# S3_ENDPOINT=https://s3.amazonaws.com
# S3_BUCKET=my-postgres-backups
# S3_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
# S3_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG...
# S3_REGION=us-east-1
# BACKUP_INTERVAL=21600
# BACKUP_RETENTION_DAYS=30

# --- Example 2: Backblaze B2 ---
# DATABASE_URL=postgresql://user:pass@host:5432/db
# S3_ENDPOINT=https://s3.us-west-002.backblazeb2.com
# S3_BUCKET=my-postgres-backups
# S3_ACCESS_KEY_ID=your-key-id
# S3_SECRET_ACCESS_KEY=your-application-key
# S3_REGION=us-west-002
# BACKUP_INTERVAL=3600
# BACKUP_RETENTION_DAYS=7

# --- Example 3: MinIO (local development) ---
# DATABASE_URL=postgresql://postgres:password@localhost:5432/testdb
# S3_ENDPOINT=http://localhost:9000
# S3_BUCKET=test-backups
# S3_ACCESS_KEY_ID=minioadmin
# S3_SECRET_ACCESS_KEY=minioadmin123
# S3_REGION=us-east-1
# BACKUP_INTERVAL=300
# BACKUP_RETENTION_DAYS=1

# --- Example 4: Production with encryption and webhooks ---
# DATABASE_URL=postgresql://produser:pass@prod-db.railway.internal:5432/prod_db
# S3_ENDPOINT=https://s3.amazonaws.com
# S3_BUCKET=production-postgres-backups
# S3_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
# S3_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG...
# S3_REGION=us-east-1
# BACKUP_INTERVAL=21600
# BACKUP_RETENTION_DAYS=90
# BACKUP_PREFIX=production/postgres/backups
# COMPRESSION_LEVEL=9
# BACKUP_ENCRYPTION=true
# BACKUP_ENCRYPTION_KEY=super-secret-encryption-key-min-32-characters-long
# WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL
# WEBHOOK_ON_SUCCESS=true
# WEBHOOK_ON_FAILURE=true
# RETRY_ATTEMPTS=5
# RETRY_DELAY=10
